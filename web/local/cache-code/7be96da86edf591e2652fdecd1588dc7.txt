...

// Tenter de récupérer l'user_id depuis le JWT du cookie
    
$GLOBALS['user_id'] = null;
$prompt = 'login';

$decoded_jwt = unserialize($_COOKIE['decoded_jwt']);
   
 if ( is_array($decoded_jwt)) {

        if ( $decoded_jwt['exp'] > time() ) {    

            // Le JWT du cookie est valide et nous donne l'user_id
            $GLOBALS['user_id'] = $decoded_jwt['sub'];        

        } else {
            // Demander un nouveau jeton sans réauthentification (prompt=none)
            $prompt = 'none';
        }       
    } 

if ( is_null($GLOBALS['user_id']) ) {  
    // sinon, il faut demander un jeton avec authentification de l'utilisateur
...