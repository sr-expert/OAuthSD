#CACHE{15}

<div class="breadcrumb"><a href="/"><:oauth:accueil:></a> - <a href="/web/?page=suivre"><:oauth:surveiller:></a> - <:oauth:alertes_ip:></div>


#INCLURE{fond=inclure/identification,env}
<BOUCLE_auteur (AUTEURS) {id_auteur=#SESSION{id_auteur}}{tout} >

    [(#REM)
    Projet OauthSD
    Copyright(c) 2019 DnC
    Auteurs : Bertrand Degoy
    Licence : GPL 3

    Logs avec DataTables.
    Table spip_oidc_logs.

    ]

    [(#SET{mots,#ENV{mots,#SESSION{mots}|unserialize}})]
    #SET{recherche,#ENV{recherche,#SESSION{recherche}}}

    <div class="nettoyeur"></div>      

    <:oauth:vous_etes_identifie_comme:> : <span class="statut">[(#STATUT|puce_statut{auteur,#ID_AUTEUR})]</span><a href="./spip.php?page=auteur-details">#NOM</a> <br /><br />

    <div id="datatable_container">


        <h2><:oauth:alertes_ip:></h2>



        #SET{recherche,#LISTE{1,3}}

        <B_bad>

            <table id="tbl" class="display datatable">

                <thead>
                    <tr>
                        <th>datetime</th>
                        <th>IP</th>
                        <th>weight</th>  
                        <th>message</th>
                    </tr>
                </thead>

                <tbody>

                    <BOUCLE_bad(spip_oidc_remote_addr) {total_weight > 20} {par maj} {inverse}>
                    #SET{msg,#ARRAY}
                    <BOUCLE_evenement2(spip_oidc_logs) {remote_addr}{par id_oidc_log}{inverse}{level>2}{0,1}>#SET{msg, #GET{msg}|push{#MESSAGE|strip_tags}}</BOUCLE_evenement2>
                    <tr>
                        <td>#MAJ</td>  
                        <td>#REMOTE_ADDR</td>
                        <td>#TOTAL_WEIGHT</td>
                        <td>[(#GET{msg}|implode{','})]</td>
                    </tr>
                    </BOUCLE_bad>    

                </tbody>

                <tfoot>
                    <tr>
                        <th>datetime</th>
                        <th>IP</th>
                        <th>weight</th>  
                        <th>message</th>
                    </tr>
                </tfoot>

            </table>
        </B_bad>
        <p><:oauth:aucune_ip:></p>
        <//B_bad>

    </div>

    <script type="text/javascript">



        $(document).ready(function() {
            
            var lang = '#ENV{lang}';
            
            /* Initialise the DataTable */

            var oTable = $('#tbl').dataTable( {
                //serverSide: true, //o2
                //select: true,
                responsive: true,
                language: {
                    url: '#CHEMIN{lib/French.json}',
                },
                "aaSorting": [[ 0, "desc" ]],
                "createdRow": function ( row, data, index ) {   //o4 Callback for whenever a TR element is created for the table's body
                    // coloration de la ligne
                    var level;
                    level = data[4];
                    index +=1;
                    str = ':nth-child(' + index + ')';
                    if ( level  == 2 ) {
                        $('tbody tr' + str).css('background-color','#d4ffff');
                    } else if ( level  == 1 ) {
                        $('tbody tr' + str).css('background-color','#ffffd4');
                    } else if ( level = 3 ) {
                        $('tbody tr' + str).css('background-color','#ffd4ff');
                    } else {
                        $('tbody tr' + str).css('background-color','#000').css('color','#fff');
                    }
                },
                //stateSave: true,        // Pour garder certains paramÃ¨tres au rechargement de la page => bug ???
                "deferRender": true,
                "columnDefs": [
                    {   "targets": 1,
                        "data": "remote_addr",
                        "render": function ( data, type, row, meta ) {
                            if ( type === "display" ) {
                                var data2 = data;
                                if ( data == '<?php echo $_SERVER['REMOTE_ADDR']; ?>' ) {
                                    data2 = 'Own IP';
                                }
                                if ( data == '<?php echo $_SERVER['SERVER_ADDR']; ?>' ) {
                                    data2 = 'Server IP';
                                }
                                return '<a href="/web/?page=evenements&remote_addr='+data+'&lang='+lang+'">'+data2+'</a>';
                            } else return data;
                        }
                    },
                ],
            });


            $('#datatable_container').fadeIn(2000);

        } ); 


    </script>

</BOUCLE_auteur>